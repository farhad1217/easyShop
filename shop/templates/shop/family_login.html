{% extends 'shop/base.html' %}
{% block title %}‡¶´‡ßç‡¶Ø‡¶æ‡¶Æ‡¶ø‡¶≤‡¶ø ‡¶≤‡¶ó‡¶á‡¶® - EasyShop{% endblock %}
{% block extra_css %}
<style>
@media (max-width: 400px) {
    .family-login-btns { flex-direction: column !important; }
    .family-login-btns .btn { width: 100% !important; }
}
.back-home-icon { display: inline-flex; align-items: center; gap: 6px; color: var(--primary); text-decoration: none; font-weight: 600; font-size: 0.9rem; margin-bottom: 16px; }
.back-home-icon:hover { color: var(--primary-dark); }
.remember-row { display: flex; align-items: center; gap: 8px; margin-bottom: 16px; }
.remember-row input { width: auto; }
</style>
{% endblock %}
{% block content %}
<div class="login-page-wrap" style="display: flex; align-items: center; justify-content: center; min-height: calc(100vh - 80px); padding: 24px 0;">
<div class="container" style="max-width: 420px; width: 100%;">
    <div class="card">
        <a href="{% url 'landing_page' %}" class="back-home-icon" title="‡¶π‡ßã‡¶Æ‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            ‡¶π‡ßã‡¶Æ
        </a>
        <div style="text-align: center; margin-bottom: 24px;">
            <h1 style="color: var(--primary);">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ‡¶´‡ßç‡¶Ø‡¶æ‡¶Æ‡¶ø‡¶≤‡¶ø ‡¶≤‡¶ó‡¶á‡¶®</h1>
        </div>
        <form method="post" id="familyLoginForm">
            {% csrf_token %}
            {% if login_error %}<p class="login-error" style="color:#dc2626;font-weight:600;margin-bottom:16px;">{{ login_error }}</p>{% endif %}
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 600; margin-bottom: 6px;">‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                <input type="text" name="phone" id="phoneField" required placeholder="01XXXXXXXXX" style="width:100%; padding:12px 16px; border:2px solid #e5e7eb; border-radius:10px;">
            </div>
            <div style="margin-bottom: 16px;">
                <label style="display: block; font-weight: 600; margin-bottom: 6px;">‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°</label>
                <div class="pw-wrap" style="position: relative;">
                    <input type="password" name="password" id="passwordField" required style="width:100%; padding:12px 44px 12px 16px; border:2px solid #e5e7eb; border-radius:10px;">
                    <button type="button" class="pw-toggle" id="pwToggle" aria-label="Show password" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;padding:4px;color:#6b7280;">üîí</button>
                </div>
            </div>
            <div class="remember-row">
                <input type="checkbox" name="remember" id="rememberCheck">
                <label for="rememberCheck">Remember Me</label>
            </div>
            <div class="family-login-btns" style="display: flex; gap: 12px;">
                <button type="submit" class="btn btn-primary btn-shine" style="flex: 1;">‡¶≤‡¶ó‡¶á‡¶®</button>
                <a href="{% url 'family_register' %}" class="btn btn-outline btn-shine">‡¶∞‡ßá‡¶ú‡¶ø‡¶∑‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶®</a>
            </div>
        </form>
    </div>
</div>
</div>
{% endblock %}
{% block extra_js %}
<script>
(function(){
    var STORAGE_KEY = 'easyshop_saved_login';
    var form = document.getElementById('familyLoginForm');
    var phoneField = document.getElementById('phoneField');
    var passwordField = document.getElementById('passwordField');
    var rememberCheck = document.getElementById('rememberCheck');    var saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
        try {
            var d = JSON.parse(saved);
            if (d.phone) phoneField.value = d.phone;
            if (d.password) passwordField.value = d.password;
            if (d.remember) rememberCheck.checked = true;
        } catch(e){}
    }

    function triggerShine(btn) {
        if (btn && btn.classList) {
            btn.classList.remove('shine-animate');
            void btn.offsetWidth;
            btn.classList.add('shine-animate');
            setTimeout(function(){ btn.classList.remove('shine-animate'); }, 600);
        }
    }

    form.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            var target = e.target;
            if (target && target.type === 'checkbox') return;
            var btn = form.querySelector('button[type="submit"]');
            setTimeout(function(){ triggerShine(btn); }, 0);
            if (!form.checkValidity()) return;
            e.preventDefault();
            form.requestSubmit();
        }
    });

    document.querySelectorAll('.btn-shine').forEach(function(btn) {
        btn.addEventListener('click', function() {
            if (btn.tagName === 'A') triggerShine(btn);
        });
    });

    var pwToggle = document.getElementById('pwToggle');
    var pwField = document.getElementById('passwordField');
    if (pwToggle && pwField) {
        pwToggle.addEventListener('click', function() {
            var isPass = pwField.type === 'password';
            pwField.type = isPass ? 'text' : 'password';
            pwToggle.textContent = isPass ? 'üîì' : 'üîí';
        });
    }

    form.addEventListener('submit', function(e) {
        var btn = form.querySelector('button[type="submit"]');
        triggerShine(btn);

        var phone = (phoneField.value || '').replace(/\s/g, '');
        var password = passwordField.value;        if (rememberCheck.checked) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({ phone: phone, password: password, remember: true }));
        } else {
            localStorage.removeItem(STORAGE_KEY);
        }
    });
})();
</script>
{% endblock %}
